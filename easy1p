#!/usr/bin/env bash
set -euo pipefail

# print versions
function print_versions {
    echo "easy-1password-cli 0.1"
    echo -n "1password-cli "
    op --version
    echo -n "jq "
    jq --version
}

# print help text
function print_help {
    echo "TODO"
}

# check for 1password-cli to be set up
function check_for_op_setup {
    if test -f ~/.op/config; then
        OP_LATEST_SIGNIN=$(cat ~/.op/config | jq --raw-output '.latest_signin')
    else
        echo "1password-cli is not set up yet. Please run 'op signin' to set it up."
    fi
}

# signin to 1password
function signin {
    eval $(op signin $1)
}

# signout of 1password
function signout {
    op signout --account $1
    unset "OP_SESSION_$1"
}

# script entry point
function main {
    check_for_op_setup
    signin $OP_LATEST_SIGNIN
    signout $OP_LATEST_SIGNIN
}

# start script
main



# TODO Shell script license
# TODO Ctrl+c Ctrl+z SIGINT catching
# TODO Clean env variables
# TODO Auto signout (especially using --raw flag, token needs to be invalidated)
# TODO check with 1password support about unsetting session variables
# TODO README
# TODO Clipboard management
# TODO Clipboard clear after time
# TODO Clipboard cleanup
# TODO consider encrypting ~/.op/config with master password
# TODO check ~/.op/config to make sure op is setup
# TODO standard 1password-cli flags to specify subdomain, accounts, vaults, etc
# TODO help, version flags
# TODO check for dependencies
# TODO session token check if needs to be renewed